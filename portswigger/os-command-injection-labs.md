# OS Command Injection (Labs)

## Simple Case

En este caso nos dicen que la vulnerabilidad se encuentra en el stock de los productos.

No tiene mucho misterio, nos ponemos primero en escucha con Burpsuite y vemos que las peticiones son tal que así.

![Petición a través de Burpsuite](<../.gitbook/assets/image (32).png>)

Por lo que si lo que hacemos es simplemente añadir un nuevo comando después del "2".

```
storeId=2;whoami
```

Ya lo tenemos acabado.

## Blind OS command injection with time delays

En este caso lo que nos piden es que hagamos un delay de 10 segundos en la respuesta, y nos dicen que la vulnerabilidad está en el apartado del feedback por lo que nos disminuyen mucho el número de posibilidades ¿Verdad?

En el formulario de feedback tenemos los siguientes parámetros:

* Name
* Email
* Subject
* Message

Podríamos pensar que es cualquiera de ellos, aunque es cierto que el Email suele ser un parámetro de comprobación, por lo que voy a empezar a probar con él.

Por ejemplo podríamos utilizar el comando "sleep" o a través de un ping

```
noesunemail||sleep+10;
noesunemail||ping+-c+10+127.0.0.1||
```

Ambos comandos son válidos y pasamos la prueba, podríamos quizás obtener información si nos currásemos un script:

* Podríamos intentar listar los elementos que hay en la carpeta dónde se está ejecutando si fuésemos haciendo peticiones y preguntando al igual que haríamos con un SQLI.
* Enviarnos los elementos a un servidor externo.
* Enviar los elementos a algún lugar en el que tengamos acceso dentro de la propia máquina o que esté expuesto.
* Crear un archivo en /var/www/ al que podamos acceder luego desde fuera...

## Blind OS command injection with output redirection

No tiene ningún misterio, tenemos que repetir el mismo proceso anterior pero colando el output en una carpeta interna a la que luego podemos tener acceso desde la web, por lo que con Burpsuite interceptamos y cambiamos el campo de email que se envía.

```
a||whoami>/var/www/images/whoami.txt;
```

A continuación nos vamos a nuestra url/image?filename=whoami.txt.

¡Acabamos!

## Blind OS command injection with out-of-band interaction

Se necesita Burpsuite Pro así que no puedo realizarlo, pero es el mismo parámetro inyectable que en los demás únicamente tenemos que realizar un nslookup para la interacción.

## Blind OS command injection with out-of-band data exfiltration

Se necesita Burpsuite Pro así que no puedo realizarlo, pero es el mismo parámetro inyectable que en los demás únicamente tenemos que realizar un nslookup para la interacción.
