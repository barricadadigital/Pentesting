---
description: >-
  Los formularios de autenticación suelen ser una de las primeras vías de
  entrada a una aplicación web.
---

# Autenticación

Los formularios de autenticación pueden permitirnos varias cosas:

* Inyecciones de código (Ver las distintas inyecciones).
* Enumeración de usuarios.
* Obtención de credenciales.

Y pueden tener distintos tipos de protección:

* Bloqueo de usuarios
* Bloqueo de IPs
* 2FA

Cómo siempre y lo más importante, probad cosas; ¿Qué pasa si hago varios intentos fallidos?, ¿Cómo son las peticiones y respuestas?, ¿Qué ocurre en un login real y en uno falso?, ¿Alguna diferencia en usuarios correctos?...

## Enumeración de usuarios

Existen diferentes vías para enumerar usuarios pero no siempre es posible:

#### Distinta respuesta

En ocasiones al poner un usuario incorrecto te indica claramente mensajes tipo "Invalid Username" Aunque en otras ocasiones es una pequeña diferencia por un fallo en la programación por lo que es interesante comparar respuestas de un usuario real y uno falso en caso de disponer de uno, o analizar las respuestas de un diccionario de usuarios que lancemos.

Ejemplo de script:

```
#!/bin/bash

URL="https://ac2f1f351fdb30c8c0f030cf00910092.web-security-academy.net/login"

while read -r i; do
        no_valido=$(curl -s -d "username=$i&password=asd" $URL | grep -oP Invalid)
        if [ "$no_valido" != "Invalid" ]; then
                echo $i
        fi
        no_valido=""
done < usuarios
```

Tenéis más ejemplos de esto en los laboratorios de Portswigger.

#### Tiempo de respuesta

En ocasiones podemos detectar tiempos de respuesta distintos en función de si el usuario es correcto o no, esto puede ocurrir porque el usuario al ser correcto compare la contraseña y tarde más tiempo el servidor en dar una respuesta.

Para detectar esto por ejemplo podemos hacerlo a través de la librería _requests_ de Python:

```
content = requests.post(url, data, headers)
tiempo = content.elapsed.total_seconds()
```

#### Bloqueo de usuarios

Puede ocurrir que si se intentan hacer varios logins incorrectos con el mismo usuario este sea bloqueado. Esto es un error ya que aparte de poder realizar una denegación de servicio también podemos enumerar usuarios correctos.

Si por ejemplo al cuarto intento bloquea el usuario podría pasar 4 veces el mismo diccionario y el que aparezca cómo "Usuario bloqueado" sería un usuario correcto.

## Obtención de credenciales

## Bloqueos y bypassing

### Bloqueo de IP

#### Número de intentos

El bloqueo de la IP puede ocurrir por el número de intentos, quizás si realizas 4 intentos desde la misma IP directamente la bloquea durante cierto tiempo o indefinidamente. Puede haber varias formas de saltarse este bloqueo:

* Mediante la cabecera X-Forwarded-For en la petición HTTP: Que nos permite indicar desde que IP está viniendo supuestamente la petición y de esta manera iterar por distintas IPs. [https://developer.mozilla.org/es/docs/Web/HTTP/Headers/X-Forwarded-For](https://developer.mozilla.org/es/docs/Web/HTTP/Headers/X-Forwarded-For)
* Mediante la red TOR: Podemos utilizar la red TOR e ir modificando cada cierto número de peticiones los nodos, de esta manera también podríamos saltarnos este bloqueo.
* También puede ocurrir que se reinicie el contador de intentos si hacemos un login correcto, de esta manera podríamos hacer 3 pruebas y loguearnos correctamente para reiniciar el contador.

#### Tiempo de las peticiones

También puede ser que lo que detecte el servidor sean tiempos muy bajos entre distintas peticiones, o incluso que detecte tiempos muy exactos. Por ejemplo podría ocurrir que entiende que si exactamente cada 4 segundos se realiza una petición no es un humano quien las realiza.

* En el primer caso podemos simplemente marcar un tiempo de espera concreto entre peticiones.
* En el segundo caso podríamos marcar un tiempo aleatorio mayor a X entre peticiones.

#### Envío de credenciales por JSON

No es lo normal pero podría ocurrir que las credenciales se enviasen por JSON, en este caso podríamos probar muchas contraseñas en un solo intento. [Ejemplo por JSON](../../../portswigger/authentication-labs.md#broken-brute-force-protection-multiple-credentials-per-request).

## 2FA



## Practicar

* Máquinas "[Authentication](../../../portswigger/authentication-labs.md)" de Portswigger \[Acceso 23/11/2021]

> \*Disclaimer: Este manual está realizado en base a lo que voy aprendiendo, si parte de la información que comparto no es correcta estaré encantado de que te pongas en contacto conmigo para hacérmelo saber y poder modificarlo.
