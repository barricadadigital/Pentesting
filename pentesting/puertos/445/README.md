# 445 - SMB

Si nos encontramos frente a un puerto 445 abierto probablemente tenemos enfrente un servidor samba. Es una serie de herramientas que se utilizan para administrar el protocolo SMB y generalmente para compartir recursos. También puede actuar como un controlador de dominio en Windows.

¿Qué podemos hacer para encontrar vulnerabilidades?

### ENUMERACIÓN DE VULNERABILIDADES CON NMAP

Existen una serie de scripts en Samba que nos permiten encontrar ciertas vulnerabilidades para enfrentarse ante un servidor samba.

```
nmap -p445 10.10.10.55 --script="smb-vuln*"
```

¡Ojo con los falsos positivos!

### NULL SESSION

También podemos comprobar si tenemos acceso a ciertos recursos a través de un NULL SESSION, esto es una sesión anónima que nos puede permitir ver ciertos recursos de la máquina a la que estamos intentando acceder o recursos compartidos con esta en la red.

```
smbclient -N -L //10.10.10.55/
smbclient -N //10.10.10.27/recursoabierto

crackmapexec smb 10.10.10.55 --shares 2>/dev/null

smbmap -H 10.10.10.55
smbmap -H 10.10.10.55 -u 'null'
```

### INFORMACIÓN SO

Podemos obtener cierta información sobre el SO y algún dato más gracias a CrackMapExec, una herramienta que además nos permite saber si el servidor SMB está o no firmado.

```
crackmapexec smb 10.10.10.55
```

### BÚSQUEDA RECURSIVA

Podemos utilizar smbmap para realizar una búsqueda rápida recursiva e incluso seleccionar el archivo que queremos descargar.

```
smbmap -d DOMINIO -H 10.10.10.55 -R SYSVOL
smbmap -d DOMINIO -H 10.10.10.55 -R SYSVOL -A Groups.xml -q
```

### LISTAR PERMISOS

```
smbcacls //10.10.10.55/Carpeta DOMINIO/directorio -U 'USUARIO%CONTRASEÑA' |grep -i everyone
```

### MÁQUINAS DONDE ENSAYAR

* [Archetype (HTB)](../../../HTB/archetype.md)
* Máquina "[Dancing](../../../HTB/dancing.md)" HTB \[Acceso 16/10/2021]



> \*Disclaimer: Este manual está realizado en base a lo que voy aprendiendo, si parte de la información que comparto no es correcta estaré encantado de que te pongas en contacto conmigo para hacérmelo saber y poder modificarlo.
